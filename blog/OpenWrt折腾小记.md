# OpenWrt折腾小记

## 缘起

偶然间在小破站刷到了AX3000T的刷机教程，想试试看，然后购入，跟着教程刷uboot，找各种固件测试，但是AX3000T 256的ram太小了，运行OpenClash内核经常崩溃，完全不可用，遂学习自己定制编译，只要必要的插件，先后测试过LEDE、Lienol和ImmortalWrt的源码，内核5.1和6.1，最终得出结论，AX3000T就是没办法运行OpenClash。然后手上有个r2s，设置旁路由，稳定性还可以。再然后想部署一些服务，r2s凑合也够用，不过手上还有一台i7 4710mq的笔记本，主板已经拆出来了，准备刷上OpenWrt，做旁路由，同时跑一些服务（也可能是先pve，然后基于pve部署吧），优点是cpu性能可以，并且有核显，并且有16g ram，缺点是功耗略高，测过低负载二三十瓦。

有台双路E5的机子，不过懒得激动，直接黑苹果跑vmware编译了，遇到的一个问题是，这玩意儿太占磁盘空间了，刚开始在ssd，后来迁移到hd了，更慢了。

## OpenWrt

2002年底，Linksys公司推出一款叫WRT-54G的路由器，大受欢迎，不过WRT-54G使用的是Linux操作系统，软件核心是基于GPL许可开发的，需遵循开源标准。Linksys公司在2003年开放了源代码，在2004年1月就出现了第一个基于Linksys源码、以OpenWRT命名的开源路由系统。另外，后续的LEDE是2016年产生的 OpenWRT 的一个分支，openwrt和LEDE这两者于2018年1月合并为一。

OpenWrt 项目是一个针对嵌入式设备的 Linux 操作系统。OpenWrt 不是一个单一且不可更改的固件，而是提供了具有软件包管理功能的完全可写的文件系统。这使您可以从供应商提供的应用范围和配置中解脱出来，并且让您通过使用适配任何应用的软件包来定制设备。对于开发人员来说，OpenWrt 是一个无需围绕它构建完整固件就能开发应用程序的框架; 对于普通用户来说，这意味着拥有了完全定制的能力，能以意想不到的方式使用该设备。

简而言之，OpenWrt本质上是一个基于Linux系统的操作系统，

## 分支

### OpenWrt

官方分支，没编译过，据说比较原生，比较稳定，有时间试试。

### LEDE

Lean是基于OpenWrt master的一个分支，由恩山论坛大佬Lean分享了全部开源代码，由于加入了很多中国特色的功能，并告诉所有人怎么通过ubuntu 编译去得到自己想要的OpenWRT，定制灵活性很强。国内大多数固件都是基于的Lean大佬的源码进行编译的，例如eSir、sirpdboy和骷髅头等等大佬！

源码只有一个master，简单省事，偶尔会有编译不过的问题，有时候甚至会回退commit。好处是内核更新比较快，编译成功率相对高一些，我目前主力在用。大多target会同时有KERNEL_PATCHVER和KERNEL_TESTING_PATCHVER，想体验最新内核，直接修改KERNEL_PATCHVER即可，并没有因为是testing而感觉更不稳定一些。

### Lienol

lienol 源码和feed上有打tag，基本和openwrt可以对照。紧跟官方版本进行更新，安装了差不多的插件lienol编译出来的固件体积比其它他人的的要小好多！由于其集成的软件少，源码改动少，使用起来稳定性更强！有动手能力的推荐自己编译这个固件使用。

有master分支和23.05分支，master分支支持更多target和更新的内核，但是我编译出来的有点儿问题，AX3000T编译出来，接口经常会离线，不知道是设置问题还是支持有问题。23.05编译倒是正常，就是内核太旧了，并且不支持AX3000T。

### ImmortalWrt

ImmortalWrt是OpenWrt的一个分支，移植了更多的软件包，支持了更多的设备，更好的性能，并为中国大陆用户进行了特殊的优化。

有master分支和23.05分支，master分支支持更多target和更新的内核，但是我编译出来的怪怪的，AX3000T编译出来感觉少了很多东西。23.05编译倒是正常，就是内核太旧了。

## 设备

### AX3000T

去年的明星产品，卖的挺好的，可以刷不死uboot，随便折腾，不怕变砖。160mhz wifi6，7981b性能可以，缺点是128rom，插件整不了太多，很容易不够用；256ram，运行OpenClash经常内核崩溃。经过各种折腾已经放弃了，就纯作为一个路由器算了。

不过现在有点儿后悔，更便宜的rax3000m有512的ram，红米的AX6000也有512的ram，入坑太早，没有意识到ram的重要性，不过也不后悔，硬路由性能终究有限，不折腾这玩意儿了。

### r2s

手头恰好有一个，性能比AX3000T不知道强到哪里去了，cpu ram rom全面碾压。

部署了alist，挂载百度云盘，一刻相册，阿里云盘，管理更方便一些。

部署了小雅的alist，瞬间拥有海量资源，emby暂时不打算搞了。

### x86

vmware测试过固件，和r2s体验差别不大，部署到硬件上，最大的差别应该就是设备性能了。

## 部署方式

### 主路由

分光猫能桥接和不能桥接，详情略，懒得说

### 旁路由

对当前网络架构影响小，详情略，懒得说

## 内网穿透

### IPv6

有些光猫默认关闭，需要手动打开。

有些路由器防火墙默认拦截，需要手动打开。

缺点是有些环境下没有v6，也有办法可以解决，不过略复杂。

### ZeroTier

免费且好用，详情略，懒得说

## 柯学

OpenWrt的几个柯学插件都配置使用过，OpenClash功能最为强大，但是比较吃性能，配置也略复杂，passwall和passwall2资源消耗比较低，但是对一些订阅支持不太友好，别的感觉没啥意思了。路由器整个柯学确实省事多了，不用每个设备都挂一个了。

顺便也测试了MacOS、Android、iOS端一些柯学软件，比以前懂得多了很多。

## 略懂OpenWrt的编译、安装、配置

## 略懂各端柯学的安装、配置

## 相关资源

* https://github.com/hanwckf/bl-mt798x
* https://github.com/openwrt/openwrt
* https://github.com/coolsnowwolf/lede
* https://github.com/Lienol/openwrt
* https://github.com/immortalwrt/immortalwrt
* https://alist.nn.ci/zh/
* https://xiaoyaliu.notion.site/xiaoya-docker-69404af849504fa5bcf9f2dd5ecaa75f